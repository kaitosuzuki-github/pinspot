<div class="p-3 space-y-2">
  <h2 class="text-lg font-semibold text-gray-900">コメント <span>(<%= post.comments.size %>)</span></h2>
  <% if user_signed_in? %>
    <div>
      <%= form_with model: [post, new_comment] do |f| %>
        <div>
          <%= f.label :content, class: "sr-only" %>
          <%= f.text_area :content, row: "2", class: "p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-gray-500 focus:border-gray-500", placeholder: "コメントを追加..." %>
        </div>
        <div>
          <%= f.submit "コメントする", class: "cursor-pointer text-gray-900 font-medium text-sm hover:text-green-400 "%>
        </div>
      <% end %>
    </div>
  <% end %>
  <div class="space-y-2 divide-y">
    <% post.comments.order(created_at: :DESC).each do |comment| %>
      <div class="relative mx-2 py-2">
        <div class="space-y-1">
          <div class="flex items-center gap-2">
            <% if comment.user.profile.avatar.present? %>
              <div class="w-8 h-8 rounded-full overflow-hidden">
                <%= image_tag comment.user.profile.avatar.variant(resize_to_limit: [100, 100]), class: "w-full h-full object-cover" %>
              </div>
            <% else %>
              <svg class="w-8 h-8 fill-gray-900" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path clip-rule="evenodd" fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-5.5-2.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 12a5.99 5.99 0 00-4.793 2.39A6.483 6.483 0 0010 16.5a6.483 6.483 0 004.793-2.11A5.99 5.99 0 0010 12z"></path>
              </svg>
            <% end %>
            <p class="text-sm text-gray-900"><%= comment.user.profile.name %></p>
          </div>
          <p class="text-gray-900"><%= safe_join(comment.content.split("\n"),tag(:br)) %></p>
          <p class="text-gray-600 text-sm"><%= l comment.updated_at, format: :long %></p>
        </div>
        <div id="dropdownWrap" class="absolute top-3 right-0">
          <button id="dropdownToggle" type="button" aria-controls="speed-dial-menu-dropdown" aria-expanded="false" class="flex items-center justify-center ml-auto hover:opacity-60">
            <svg aria-hidden="true" class="w-6 h-6 fill-gray-900" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"></path>
            </svg>
            <span class="sr-only">Open actions menu</span>
          </button>
          <div id="dropdownMenu" class="justify-end py-1 mb-4 space-y-2 bg-white border border-gray-100 rounded-lg shadow-sm duration-100 dropdown-invisible">
            <ul class="text-sm text-gray-500">
              <li>
                <%= button_to "削除", post_comment_path(post, comment), method: :delete, data: { turbo_confirm: '本当に削除しますか?' }, class: "flex items-center px-5 py-2 hover:bg-gray-100 hover:text-gray-900 text-sm font-medium" %>
              </li>
            </ul>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
