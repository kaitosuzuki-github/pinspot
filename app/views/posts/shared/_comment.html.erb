<div class="p-3 space-y-2">
  <h2 class="text-lg font-semibold text-gray-900">コメント <span>(<%= comments.size %>)</span></h2>
  <% if user_signed_in? %>
    <div>
      <%= form_with model: [post, new_comment] do |f| %>
        <div>
          <%= f.label :content, class: "sr-only" %>
          <%= f.text_area :content, row: "2", class: "p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-gray-500 focus:border-gray-500", placeholder: "コメントを追加..." %>
        </div>
        <div>
          <%= f.submit "コメントする", class: "cursor-pointer text-gray-900 font-medium text-sm hover:text-green-400" %>
        </div>
      <% end %>
    </div>
  <% end %>
  <div class="space-y-2 divide-y">
    <% comments.each do |comment| %>
      <div class="relative mx-2 py-2">
        <div class="space-y-1">
          <%= link_to comment.user.profile, class: "flex items-center gap-2 w-fit" do %>
            <% if comment.user.profile.avatar.attached? %>
              <div class="w-8 h-8 rounded-full overflow-hidden">
                <%= image_tag comment.user.profile.avatar.variant(resize_to_limit: [100, 100]), class: "w-full h-full object-cover" %>
              </div>
            <% else %>
              <%= render "shared/icons/user", class_list: "w-8 h-8 fill-gray-900" %>
            <% end %>
            <p class="text-sm text-gray-900"><%= comment.user.profile.name %></p>
          <% end %>
          <p class="text-gray-900"><%= safe_join(comment.content.split("\n"), tag(:br)) %></p>
          <p class="text-gray-600 text-sm"><%= l comment.updated_at, format: :long %></p>
        </div>
        <% if user_signed_in? %>
          <% if current_user.same_user?(comment.user_id) %>
            <div id="dropdownWrap" class="absolute top-3 right-0">
              <button id="dropdownToggle" type="button" class="flex items-center justify-center ml-auto hover:opacity-60">
                <%= render "shared/icons/dot_menu", class_list: "w-6 h-6 fill-gray-900" %>
              </button>
              <div id="dropdownMenu" class="justify-end py-1 mb-4 space-y-2 bg-white border border-gray-100 rounded-lg shadow-sm duration-100 fade-out">
                <ul class="text-sm text-gray-500">
                  <li>
                    <%= button_to "削除", post_comment_path(post, comment), method: :delete, data: { turbo_confirm: '本当に削除しますか?' }, class: "flex items-center px-5 py-2 hover:bg-gray-100 hover:text-gray-900 text-sm font-medium" %>
                  </li>
                </ul>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
